<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for Ticket</title>
    <link rel="stylesheet" href="/static/styles/global.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="/student">Home</a></li>
            <li><a href="/logout">Logout</a></li>
        </ul>
    </nav>

    <div class="apply-ticket">
        <form class="ticket-form" method="post" action="/student/order/confirm.php">
            <div class="form-group">
                <label for="name">Name:</label>
                <p id="name" name="name" class="value">{{ name }}</p>
            </div>
            
            <div class="form-group">
                <label for="department">Department:</label>
                <p id="department" name="department" class="value">{{ department }}</p>
            </div>
            
            <div class="form-group">
                <label for="from-to">From/To:</label>
                <select id="from-to" name="from-to" onchange="update_price()" required>
                    {% for row in place %}
                    <option price={{ row['Price'] }} value={{ row['Place'] }}>{{ row['Place'] }}</option>
                    {% endfor %}
                </select>
            </div>

            {% if usertype == 1 %}
                <div class="form-group">
                    <label for="datefrom">From Date:</label>
                    <input type="date" id="datefrom" name="datefrom" onchange="update_price()" required>
                </div>

                <div class="form-group">
                    <label for="dateto">To Date:</label>
                    <input type="date" id="dateto" name="dateto" onchange="update_price()" required>
                </div>
            {% elseif usertype == 2 %}
                <div class="form-group hidden" style="display:none;">
                    <label for="datefrom">From Date:</label>
                    <input type="date" id="datefrom" name="datefrom" onchange="update_price()" required>
                </div>
                <div class="form-group">
                    <label for="dateto">Date:</label>
                    <input type="date" id="dateto" name="dateto" onchange="update_price()" required>
                </div>
            {% endif %}
            
            <div class="form-group">
                <label for="admin-no">Admin No:</label>
                <p id="admin-no" name="admin-no" class="value">{{ adm_no }}</p>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" class="value" required>
            </div>
            
            <div class="form-group">
                <button type="submit" id="pay" class="pay-button" style="display: none;">Pay ₹</button>
            </div>
        </form>
    </div>

    <script>
const usertype = "{{ usertype }}";

function update_price() {
    var fromDate = document.getElementById("datefrom").value;
    var toDate = document.getElementById("dateto").value;
    var pay = document.getElementById("pay");

    if (usertype === "2") {
        document.getElementById("datefrom").value = toDate;
        fromDate=toDate;
    }

    if (fromDate && toDate) {
        var startDate = new Date(fromDate);
        var endDate = new Date(toDate);
        var timeDifference = endDate - startDate;
        var validity = Math.ceil(timeDifference / (1000 * 60 * 60 * 24)) + 1;

        if (validity > 0) {
            var selectElement = document.getElementById("from-to");
            var selectedOption = selectElement.options[selectElement.selectedIndex];
            var price = parseFloat(selectedOption.getAttribute("price"));

            var amount = price * validity;
            pay.innerHTML = `Pay ₹${amount}`;
            pay.style.display = "block";
        } else {
            pay.innerHTML = "Invalid date range. Please select a valid To Date.";
            pay.style.display = "block";
        }
    } else {
        pay.style.display = "none";
    }
}
    </script>
</body>
</html>
